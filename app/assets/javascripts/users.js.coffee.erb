<% url = Envelopes::Application.routes.url_helpers %>

$ ->
  $('#account input').selectOnFocus().on 'keydown', (event) ->
    if event.which == 13
      event.preventDefault()

  $('#account .new').on 'click', (event) ->
    event.preventDefault()
    newIndex = $('#account ul.questions li').length - 1
    newItemHtml = $('#questions_template').text().replace /index/g, newIndex
    $(newItemHtml)
      .hide()
      .insertBefore($(this).parent())
      .slideDown()
      .find('input').selectOnFocus()

  $('#account .questions').on 'click', '.destroy', (event) ->
    event.preventDefault()
    $(this).parent().slideUp ->
      $(this).remove()

  $('#account .import').click ->
    modal = showModal
      content: '#import_modal'
      width: 510
      className: 'import-modal'
    $.post("<%= url.import_transactions_path %>")
      .error (data) ->
        hideModal()
        #regex = /<h1>\s*([^<]*)\s*<\/h1>\s*<pre>([^<]*)/m
        #matches = regex.exec(data.responseText)

        $("<div class='flash alert'><div>An error occurred!</div></div>")
          .appendTo('body')
          .delay(8000)
          .fadeOut ->
            $(this).remove()
